<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Hex Helper · MAUL</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta property="og:title" content="Hex Helper · MAUL" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://moddedamong.us/hexhelper.html" />
    <meta property="og:image" content="https://moddedamong.us/images/banner.png" />
    <meta property="og:description" content="Letter-only hex picker and tag-line snapper (A–F only)." />
    <meta property="og:site_name" content="Modded Among Us Lobbies" />
    <meta property="og:locale" content="en_US" />
    <link rel="canonical" href="https://moddedamong.us/hexhelper.html" />
    <link rel="shortcut icon" type="image/png" href="images/favicon.png" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Poppins:wght@500;700;800&display=swap" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-pcKRe3h4c9VBPlPfwDrLEkHZ90a4q/OzHD7S9vMYI9z1y9u2c7p7x5AcZx/9H84zYZlzGw8c47jM7TCtWbsxkA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <style>

      :root {
        --accent: #800000;
        --accent-soft: rgba(128, 0, 0, 0.25);
        --accent-strong: #b00000;
        --bg-card: rgba(30, 12, 12, 0.9);
        --bg-soft: rgba(45, 18, 18, 0.9);
        --text-main: #ffffff;
        --text-muted: #dedee8;
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
        font-family: "Roboto", sans-serif;
        color: var(--text-main);
        overflow-x: hidden;
      }

      body {
        background: #000 url("images/maulredbg.png") no-repeat top center fixed;
        background-size: auto 100%;
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: stretch;
      }

      body::before {
        content: "";
        position: fixed;
        inset: 0;
        background:
          radial-gradient(circle at top, rgba(128, 0, 0, 0.45), transparent 55%),
          radial-gradient(circle at bottom, rgba(180, 0, 60, 0.25), transparent 55%);
        mix-blend-mode: screen;
        opacity: 0.7;
        pointer-events: none;
        z-index: -2;
      }

      body::after {
        content: "";
        position: fixed;
        inset: 0;
        background: radial-gradient(circle at center, rgba(20, 0, 0, 0.75), rgba(5, 0, 0, 0.9));
        z-index: -1;
      }

      .dropdown {
        position: fixed;
        top: 18px;
        left: 18px;
        z-index: 100;
      }

      .dropbtn {
        background: rgba(35, 10, 10, 0.9);
        border: 1px solid rgba(255, 255, 255, 0.14);
        cursor: pointer;
        transition:
          transform 0.25s ease,
          box-shadow 0.25s ease,
          background 0.25s ease;
        padding: 10px 10px;
        border-radius: 999px;
        backdrop-filter: blur(10px);
      }

      .dropbtn:hover {
        transform: translateY(-1px) scale(1.03);
        background: rgba(50, 16, 16, 0.98);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.7);
      }

      .hamburger {
        width: 26px;
        height: 18px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }

      .hamburger span {
        display: block;
        height: 3px;
        background: linear-gradient(90deg, var(--accent), #ff0040);
        border-radius: 999px;
      }

      .dropdown-content {
        display: none;
        position: absolute;
        margin-top: 8px;
        background-color: rgba(35, 10, 10, 0.96);
        min-width: 220px;
        box-shadow: 0 16px 40px rgba(0, 0, 0, 0.85);
        border-radius: 12px;
        overflow: hidden;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.08);
      }

      .dropdown.open .dropdown-content {
        display: block;
      }

      .dropdown-content a {
        color: var(--text-main);
        padding: 12px 18px;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.95rem;
        transition:
          background 0.25s,
          color 0.25s,
          padding-left 0.25s;
      }

      .dropdown-content a:hover {
        background: rgba(255, 255, 255, 0.04);
        color: var(--accent);
        padding-left: 22px;
      }

      .beta-glow {
        color: #ff4d4d !important;
        font-weight: 700;
        text-shadow:
          0 0 8px rgba(255, 0, 0, 0.75),
          0 0 12px rgba(255, 0, 0, 0.55);
      }

      .page-wrapper {
        max-width: 1200px;
        width: 100%;
        margin: 0 auto 40px;
        padding: 80px 20px 0;
      }

      @media (max-width: 600px) {
        .page-wrapper {
          padding-top: 90px;
        }
      }

      .header {
        position: relative;
        text-align: center;
        padding: 40px 20px 20px;
      }

      .header-badge {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 12px;
        border-radius: 999px;
        font-size: 0.8rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        background: linear-gradient(
          120deg,
          rgba(128, 0, 0, 0.5),
          rgba(200, 0, 80, 0.35)
        );
        border: 1px solid rgba(255, 255, 255, 0.18);
        color: var(--text-muted);
        margin-bottom: 16px;
      }

      .header-badge-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: radial-gradient(circle, #00ff9c, #00b36b);
        box-shadow: 0 0 12px rgba(0, 255, 156, 0.7);
      }

      .header h1 {
        font-family: "Poppins", sans-serif;
        font-size: clamp(2.4rem, 4vw, 3.2rem);
        margin: 0;
        text-shadow: 0 8px 30px rgba(0, 0, 0, 0.9);
        letter-spacing: 0.04em;
      }

      .header h1 span {
        background: linear-gradient(120deg, #ffffff, var(--accent));
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
      }

      .header-subtitle {
        max-width: 720px;
        margin: 14px auto 0;
        color: var(--text-muted);
        font-size: 0.95rem;
        line-height: 1.6;
      }

      .header-highlight {
        color: var(--accent);
        font-weight: 600;
      }

      .header-actions {
        margin-top: 24px;
        display: flex;
        justify-content: center;
        gap: 14px;
        flex-wrap: wrap;
      }

      .cta-primary,
      .cta-secondary {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 9px 16px;
        border-radius: 999px;
        text-decoration: none;
        font-size: 0.9rem;
        cursor: pointer;
        transition:
          background 0.2s ease,
          border-color 0.2s ease,
          transform 0.18s ease,
          box-shadow 0.18s ease,
          filter 0.18s ease;
      }

      .cta-primary {
        padding: 10px 18px;
        background: linear-gradient(135deg, #800000, #b00000);
        color: #ffffff;
        font-weight: 600;
        font-size: 0.95rem;
        box-shadow: 0 10px 26px rgba(0, 0, 0, 0.9);
      }

      .cta-secondary {
        border: 1px solid rgba(255, 255, 255, 0.22);
        background: rgba(40, 12, 12, 0.9);
        color: var(--text-muted);
      }

      .cta-primary i,
      .cta-secondary i {
        font-size: 0.9em;
      }

      .cta-secondary:hover {
        background: rgba(55, 18, 18, 0.98);
        border-color: var(--accent-soft);
        transform: translateY(-1px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.9);
      }

      .cta-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 14px 34px rgba(0, 0, 0, 0.95);
        filter: brightness(1.05);
      }

      .info-paragraph {
        font-size: 0.98rem;
        line-height: 1.7;
        background: var(--bg-card);
        padding: 22px 24px;
        border-radius: 16px;
        max-width: 900px;
        margin: 28px auto 20px;
        text-align: left;
        box-shadow: 0 18px 40px rgba(0, 0, 0, 0.85);
        border: 1px solid rgba(255, 255, 255, 0.08);
      }

      .info-paragraph strong {
        color: var(--accent);
        font-weight: 600;
      }

      .info-paragraph a {
        color: var(--accent);
        text-decoration: none;
        font-weight: 500;
      }

      .info-paragraph a:hover {
        text-decoration: underline;
        color: var(--accent-strong);
      }

      .content-grid {
        max-width: 1100px;
        width: 100%;
        margin: 0 auto 40px;
        padding: 0 20px 10px;
        display: grid;
        gap: 22px;
      }

      .panel {
        background: var(--bg-card);
        border-radius: 20px;
        padding: 22px 22px 24px;
        border: 1px solid rgba(255, 255, 255, 0.08);
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.95);
        backdrop-filter: blur(14px);
      }

      .section-title {
        font-size: 1.7rem;
        margin: 0 0 6px;
        text-align: center;
        letter-spacing: 0.12em;
        text-transform: uppercase;
      }

      .section-subtitle {
        text-align: center;
        color: var(--text-muted);
        margin: 0 0 18px;
        font-size: 0.9rem;
      }

      @media (max-width: 700px) {
        .content-grid {
          padding: 0 14px 10px;
        }

        .page-wrapper {
          padding-top: 80px;
        }
      }

      .gen-wrap {
        display: grid;
        gap: 14px;
      }

      .gen-controls {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
      }

      .gen-controls .field {
        display: flex;
        align-items: center;
        gap: 6px;
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.16);
        padding: 6px 8px;
        border-radius: 999px;
        font-size: 0.85rem;
        color: var(--text-muted);
      }

      .gen-controls .field label {
        font-size: 0.9em;
      }

      .gen-controls input[type="text"],
      .gen-controls input[type="number"],
      .gen-controls select,
      .gen-controls textarea {
        background: rgba(0, 0, 0, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        color: #def;
        padding: 4px 6px;
      }

      .gen-controls select {
        min-width: 160px;
      }

      .gen-controls textarea {
        width: 100%;
        min-height: 36px;
        resize: vertical;
      }

      .gen-stops {
        display: grid;
        gap: 8px;
      }

      .gen-stop {
        display: grid;
        grid-template-columns: 110px 1fr auto;
        gap: 8px;
        align-items: center;
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.16);
        border-radius: 12px;
        padding: 8px;
      }

      .gen-stop .color {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .gen-stop input[type="color"] {
        width: 42px;
        height: 32px;
        border: none;
        background: transparent;
        padding: 0;
        cursor: pointer;
      }

      .gen-stop input[type="text"] {
        width: 100%;
        background: rgba(0, 0, 0, 0.65);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        color: #def;
        padding: 6px;
      }

      .gen-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      .copy-btn {
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.22);
        color: #e7f0ff;
        font-size: 0.9em;
        padding: 6px 10px;
        border-radius: 999px;
        cursor: pointer;
        transition:
          background 0.2s,
          border-color 0.2s,
          transform 0.02s,
          box-shadow 0.2s;
      }

      .copy-btn:hover {
        background: rgba(255, 255, 255, 0.12);
        border-color: rgba(255, 255, 255, 0.3);
        box-shadow: 0 8px 18px rgba(0, 0, 0, 0.8);
      }

      .copy-btn:active {
        transform: scale(0.98);
      }

      .gen-output {
        display: grid;
        gap: 8px;
      }

      .gen-output code {
        display: block;
        background: rgba(0, 0, 0, 0.7);
        border: 1px solid rgba(255, 255, 255, 0.22);
        border-radius: 12px;
        padding: 8px;
        white-space: normal;
        word-break: break-word;
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono",
          monospace;
        font-size: 0.85rem;
      }

      #ntg-visual span {
        display: inline-block;
      }

      #ntg-stops {
        max-height: 220px;
        overflow: auto;
      }

      #ntg-preview,
      #ntg-lotus-grad-preview {
        height: 44px;
        border-radius: 8px;
        border: 1px solid #000;
        margin: 8px 0;
      }

      details summary {
        cursor: pointer;
      }

      h4 {
        margin: 6px 0;
      }

      #ntg-lotus-visual {
        text-align: center;
        line-height: 1.2;
        padding: 6px 10px;
        border-radius: 8px;
        background: rgba(0, 0, 0, 0.55);
        display: inline-block;
      }

      .lotus-line {
        display: block;
        font-size: 1.2em;
        font-weight: 700;
        margin: 2px 0;
        padding: 0 0.15em;
        -webkit-text-stroke: 0;
        text-shadow: 0 0 4px rgba(0, 0, 0, 0.85);
      }

      .lotus-name-line {
        font-size: 1.4em;
      }

      footer {
        width: 100%;
        display: flex;
        justify-content: center;
        margin: 40px 0 30px;
        padding: 0 16px;
      }

      .footer-inner {
        max-width: 900px;
        width: 100%;
        text-align: center;
        padding: 18px 24px;
        border-radius: 18px;
        background:
          radial-gradient(circle at top, rgba(255, 255, 255, 0.06), transparent 55%),
          linear-gradient(135deg, #240404, #0b0000);
        border: 1px solid rgba(255, 255, 255, 0.12);
        box-shadow: 0 18px 40px rgba(0, 0, 0, 0.9);
        font-size: 0.9rem;
        color: var(--text-muted);
      }

      .footer-inner a {
        color: var(--accent-strong);
        text-decoration: none;
        font-weight: 600;
      }

      .footer-inner a:hover {
        color: #ff0000;
        text-decoration: underline;
      }
    

/* --- Hex Helper specific --- */

.hex-grid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:22px;
}
@media (max-width:980px){ .hex-grid{ grid-template-columns:1fr; } }

.hex-panel h2{
  margin:0 0 10px;
  font-family: "Poppins", sans-serif;
  letter-spacing: .18em;
  text-transform: uppercase;
  font-size: 1.05rem;
  text-align:left;
}
.hex-sub{color: var(--text-muted); font-size:.92rem; line-height:1.6; margin:0 0 14px}

.hex-row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
.hex-input{
  flex:1; min-width:240px;
  background: rgba(0,0,0,0.6);
  color:#fff;
  border:1px solid rgba(255,255,255,.2);
  border-radius: 12px;
  padding: 12px 14px;
  font-size: 1rem;
  outline: none;
}
.hex-input:focus{border-color: rgba(255,255,255,.35)}
.hex-btn{
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,.22);
  background: rgba(255,255,255,.08);
  color:#fff;
  padding: 10px 16px;
  cursor:pointer;
  transition: transform .18s ease, background .2s ease, box-shadow .2s ease, filter .2s ease;
}
.hex-btn:hover{background: rgba(255,255,255,.12); transform: translateY(-1px); box-shadow: 0 10px 26px rgba(0,0,0,.85)}
.hex-btn.primary{
  background: linear-gradient(135deg, var(--accent), var(--accent-strong));
  border-color: rgba(255,255,255,.18);
  font-weight: 600;
}
.hex-btn.primary:hover{filter: brightness(1.05)}

.hex-subhead{
  margin: 18px 0 10px;
  font-family: "Poppins", sans-serif;
  letter-spacing: .14em;
  text-transform: uppercase;
  font-size: .85rem;
  color: rgba(255,255,255,.85);
}

.palette-grid{
  display:grid;
  grid-template-columns: repeat(18, 1fr);
  gap:10px;
  padding:16px 16px 18px;
  border-radius:16px;
  background: rgba(0,0,0,.38);
  border:1px solid rgba(255,255,255,.12);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
  overflow:hidden;
}
.swatch-dot{
  width:18px;height:18px;border-radius:999px;
  border:1px solid rgba(0,0,0,.35);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.12);
  cursor:pointer;
  transition: transform .08s ease, filter .12s ease;
}
.swatch-dot:hover{transform:translateY(-1px); filter:brightness(1.06)}
.swatch-dot.selected{outline:2px solid rgba(255,255,255,.85); outline-offset:2px}
@media(max-width:520px){
  .palette-grid{grid-template-columns:repeat(12,1fr); gap:9px}
  .swatch-dot{width:17px;height:17px}
}

.current-swatch{
  height: 96px;
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,.18);
  background:#BEEFEE;
  box-shadow: 0 18px 36px rgba(0,0,0,.75), inset 0 0 0 1px rgba(255,255,255,.08);
  margin: 6px 0 14px;
}
.valid{color: var(--text-muted); font-size:.92rem; margin:0 0 8px}
.ok{color:#00ff9c; font-weight:700}
.warn{color:#ff4d4d; font-weight:700}

.hex-label{
  text-align:center;
  color: rgba(255,255,255,.55);
  letter-spacing:.18em;
  text-transform: uppercase;
  font-size: .75rem;
  margin-top: 8px;
}
.hex-big{
  text-align:center;
  margin: 10px 0 2px;
  font-weight: 800;
  letter-spacing: .1em;
  font-size: 1rem;
  font-family: "Poppins", sans-serif;
}

.snap-title{
  margin: 18px 0 8px;
  font-family: "Poppins", sans-serif;
  font-size: .75rem;
  letter-spacing: .18em;
  text-transform: uppercase;
}
.hex-ta{
  width:100%;
  min-height:120px;
  resize:vertical;
  background: rgba(0,0,0,.65);
  border: 1px solid rgba(255,255,255,.22);
  border-radius: 12px;
  color: #eaf2ff;
  padding: 12px;
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  font-size: .86rem;
  outline:none;
}
.outbox{min-height:98px}

    </style>
  </head>

  <body>
<div class="dropdown" id="navDropdown">
      <button class="dropbtn" type="button" aria-label="Open navigation menu" aria-expanded="false">
        <div class="hamburger">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </button>
      <div class="dropdown-content">
      <a href="https://moddedamong.us/"><i class="fa-solid fa-house"></i> Home</a>
      <a href="https://moddedamong.us/art.html"><i class="fa-solid fa-paintbrush"></i> User Art</a>
      <a href="https://moddedamong.us/ourstaff.html"><i class="fa-solid fa-users-gear"></i> Our Staff</a>
      <a href="https://moddedamong.us/tags.html"><i class="fa-solid fa-users-gear"></i> Lobby Tags</a>
      <a href="https://moddedamong.us/eventpics.html"><i class="fa-regular fa-images"></i> Past Events</a>
      <a href="https://moddedamong.us/calendar.html"><i class="fa-regular fa-calendar"></i> Event Calendar</a>
      <a href="https://moddedamong.us/mods.html"><i class="fa-solid fa-code-branch"></i> Featured Mods</a>
      <a href="https://moddedamong.us/presets.html"><i class="fa-solid fa-sliders"></i> Mod Presets</a>
      <a href="https://moddedamong.us/tags.html"><i class="fa-solid fa-ticket"></i> Tag Generator</a>
      <a href="https://moddedamong.us/icons.html"><i class="fa-regular fa-face-smile"></i> Icons and Fonts</a>
      <a href="https://moddedamong.us/lobbytemplates"><i class="fa-solid fa-list"></i> Lobby Templates</a>
      <a href="https://moddedamong.us/wrapped"><i class="fa-solid fa-gift"></i> <span class="beta-glow">NEW</span> – 2025 Wrapped</a>
      <a href="https://moddedamong.us/roletest"><i class="fa-solid fa-brain"></i> <span class="beta-glow">NEW</span> – Personality Test</a>
      <a href="https://moddedamong.us/BETAtemplates" class="beta-glow"><i class="fa-solid fa-flask"></i> BETA Templates</a>
      </div>
    </div>

    <div class="page-wrapper">
      <div class="header">
        <div class="header-badge">
          <span class="header-badge-dot"></span>
          Template tools for MAUL lobbies
        </div>
        <h1><span>Hex Helper</span></h1>
        <p class="header-subtitle">
          Snap any hex into <span class="header-highlight">A–F-only</span> colors and clean up
          <strong>&lt;color=#RRGGBB&gt;</strong> tag lines for lobby templates.
        </p>
        <div class="header-actions">
          <a href="https://moddedamong.us/" class="cta-secondary">
            <i class="fa-solid fa-arrow-left"></i>
            Back to Home
          </a>
          <a href="https://moddedamong.us/tags.html" class="cta-primary">
            <i class="fa-solid fa-ticket"></i>
            Tag Studio
          </a>
        </div>
      </div>

      <p class="info-paragraph">
        Paste a normal hex and we’ll snap it to the nearest <strong>A–F-only</strong> value (no numbers).
        Use the palette to pick from valid colors, or paste a whole tag line and convert every hex in one click.
      </p>

      <main class="content-grid">
        <div class="hex-grid">
          <section class="panel hex-panel" aria-label="Manual hex">
            <h2>Manual Hex</h2>
            <p class="hex-sub">Paste any hex (#RRGGBB). We’ll snap it to letters-only.</p>

            <div class="hex-row">
              <input id="hexInput" class="hex-input" type="text" value="#BEEFEE" placeholder="#RRGGBB" maxlength="64" />
              <button class="hex-btn" id="copyHex" type="button">Copy</button>
              <button class="hex-btn" id="shuffleBtn" type="button">Shuffle</button>
            </div>

            <div class="hex-subhead">Palette (A–F-only)</div>
            <div class="palette-grid" id="paletteGrid" aria-label="A–F-only palette"></div>
          </section>

          <section class="panel hex-panel" aria-label="Current color">
            <h2>Current Color</h2>

            <div class="current-swatch" id="singleSwatch"></div>
            <div class="valid" id="hexStatus">Valid: <span class="ok">A–F only</span></div>
            <div class="hex-label">Hex</div>
            <div class="hex-big" id="singleHexBig">#BEEFEE</div>

            <div class="snap-title">Snap &amp; Clean &lt;color=#...&gt; lines</div>
            <p class="hex-sub" style="margin-bottom:10px">Paste your string. Every #RRGGBB becomes the nearest A–F-only hex.</p>

            <textarea id="lineIn" class="hex-ta" spellcheck="false" placeholder='<color=#ffc94f>†</color><color=#ffb646>乂</color>...'></textarea>

            <div class="hex-row" style="margin:12px 0 10px">
              <button class="hex-btn primary" id="snapLineBtn" type="button">Snap</button>
              <button class="hex-btn" id="copyLineBtn" type="button">Copy</button>
            </div>

            <div class="hex-sub" style="margin:0 0 8px">Output</div>
            <textarea id="lineOut" class="hex-ta outbox" spellcheck="false" readonly></textarea>
          </section>
        </div>
      </main>

      <footer>
        <div class="footer-inner">
          <p>Made with ♥ by MAUL</p>
        </div>
      </footer>
    </div>

    <script>
(() => {
  "use strict";

  const dropdown = document.querySelector(".dropdown");
  const dropbtn = document.querySelector(".dropbtn");
  dropbtn?.addEventListener("click", (e) => {
    e.stopPropagation();
    const isOpen = dropdown.classList.toggle("open");
    dropbtn.setAttribute("aria-expanded", String(isOpen));
  });
  document.addEventListener("click", (e) => {
    if (!dropdown) return;
    if (!dropdown.contains(e.target)) {
      dropdown.classList.remove("open");
      dropbtn?.setAttribute("aria-expanded", "false");
    }
  });

  const hexInput   = document.getElementById("hexInput");
  const copyHexBtn = document.getElementById("copyHex");
  const shuffleBtn = document.getElementById("shuffleBtn");
  const paletteGrid= document.getElementById("paletteGrid");

  const swatch     = document.getElementById("singleSwatch");
  const hexBig     = document.getElementById("singleHexBig");
  const statusEl   = document.getElementById("hexStatus");

  const lineIn     = document.getElementById("lineIn");
  const lineOut    = document.getElementById("lineOut");
  const snapBtn    = document.getElementById("snapLineBtn");
  const copyLineBtn= document.getElementById("copyLineBtn");
  const AF_NIBBLES = [10,11,12,13,14,15];
  const AF_BYTES = (() => {
    const out = [];
    for (const hi of AF_NIBBLES) for (const lo of AF_NIBBLES) out.push((hi<<4) | lo);
    out.sort((a,b)=>a-b);
    return out;
  })();

  const clamp01 = (x)=>Math.max(0, Math.min(1, x));

  function parseHexToRgb(any) {
    const s = String(any || "").trim();
    const m = s.match(/#?([0-9a-fA-F]{6})/);
    if (!m) return null;
    const h = m[1];
    return { r: parseInt(h.slice(0,2),16), g: parseInt(h.slice(2,4),16), b: parseInt(h.slice(4,6),16) };
  }
  function rgbToHex({r,g,b}) {
    const to2 = (n)=>n.toString(16).padStart(2,"0").toUpperCase();
    return `#${to2(r)}${to2(g)}${to2(b)}`;
  }
  function nearestAfByte(v){
    let best = AF_BYTES[0], bestD = Infinity;
    for (const b of AF_BYTES){
      const d = Math.abs(v - b);
      if (d < bestD){ bestD = d; best = b; }
    }
    return best;
  }
  function snapRgbToAF(rgb){ return { r:nearestAfByte(rgb.r), g:nearestAfByte(rgb.g), b:nearestAfByte(rgb.b) }; }

  function normalizeAFHex(input){
    const raw = String(input || "").trim();
    const rgb = parseHexToRgb(raw);
    if (rgb){
      let out = rgbToHex(snapRgbToAF(rgb));
      if (out === "#ABABAB") out = "#ACACAC";
      return out;
    }
    const letters = raw.toUpperCase().replace(/[^A-F]/g,"");
    let out = `#${(letters + "FFFFFF").slice(0,6)}`;
    if (out === "#ABABAB") out = "#ACACAC";
    return out;
  }

  function hsvToRgb(h, s, v){
    h = ((h % 360) + 360) % 360;
    s = clamp01(s); v = clamp01(v);
    const c = v * s;
    const x = c * (1 - Math.abs(((h / 60) % 2) - 1));
    const m = v - c;
    let r=0,g=0,b=0;
    if (h < 60){ r=c; g=x; b=0; }
    else if (h < 120){ r=x; g=c; b=0; }
    else if (h < 180){ r=0; g=c; b=x; }
    else if (h < 240){ r=0; g=x; b=c; }
    else if (h < 300){ r=x; g=0; b=c; }
    else { r=c; g=0; b=x; }
    return { r: Math.round((r+m)*255), g: Math.round((g+m)*255), b: Math.round((b+m)*255) };
  }

  function buildPalette(seed=0){
    if (!paletteGrid) return;
    paletteGrid.innerHTML = "";

    const cols = 18;
    const rows = 4; 
    const sat  = [0.35, 0.45, 0.55, 0.40];
    const val  = [0.98, 0.92, 0.86, 0.78];
    const neutralHexes = ["#FFFFFF","#EEEEEE","#DDDDDD","#CCCCCC","#BBBBBB","#AAAAAA"];

    for (let r=0; r<rows; r++){
      for (let c=0; c<cols; c++){
        let hex;
        if (c < 2) {
          hex = neutralHexes[(r*2 + c) % neutralHexes.length];
        } else {
          const hue = (seed + ((c-2)/(cols-2))*360) % 360;
          const rgb = hsvToRgb(hue, sat[r], val[r]);
          hex = rgbToHex(snapRgbToAF(rgb));
        }
        if (hex === "#ABABAB") continue;
        const dot = document.createElement("div");
        dot.className = "swatch-dot";
        dot.style.background = hex;
        dot.dataset.hex = hex;
        dot.title = hex;
        dot.addEventListener("click", () => { hexInput.value = hex; render(); });
        paletteGrid.appendChild(dot);
      }
    }
    syncSelection();
  }

  function syncSelection(){
    if (!paletteGrid) return;
    const snapped = normalizeAFHex(hexInput.value);
    paletteGrid.querySelectorAll(".swatch-dot.selected").forEach(el => el.classList.remove("selected"));
    const match = paletteGrid.querySelector(`.swatch-dot[data-hex="${snapped}"]`);
    if (match) match.classList.add("selected");
  }

  function render(){
    const snapped = normalizeAFHex(hexInput.value);
    if (swatch) swatch.style.background = snapped;
    if (hexBig) hexBig.textContent = snapped;

    const raw = (hexInput.value || "").trim().toUpperCase();
    const isAF = /^#?[A-F]{6}$/.test(raw.replace(/^#+/,""));
    if (statusEl){
      statusEl.innerHTML = isAF
        ? 'Valid: <span class="ok">A–F only</span>'
        : 'Snapped: <span class="warn">nearest A–F-only</span>';
    }
    syncSelection();
  }

  async function copyText(txt){
    try{
      await navigator.clipboard.writeText(txt);
    }catch{
      const ta=document.createElement("textarea");
      ta.value=txt; document.body.appendChild(ta);
      ta.select(); document.execCommand("copy");
      ta.remove();
    }
  }

  copyHexBtn?.addEventListener("click", () => copyText(normalizeAFHex(hexInput.value)));
  hexInput?.addEventListener("input", render);

  let seed = 0;
  shuffleBtn?.addEventListener("click", () => {
    seed = (seed + 37) % 360;
    buildPalette(seed);
  });

  function snapLine(str){
    const s = String(str || "");
    return s.replace(/#([0-9a-fA-F]{6})/g, (m, hex) => normalizeAFHex("#"+hex));
  }

  snapBtn?.addEventListener("click", () => { lineOut.value = snapLine(lineIn.value); });
  copyLineBtn?.addEventListener("click", () => copyText(lineOut.value || ""));

  buildPalette(seed);
  render();
})();
</script>
  </body>
</html>

