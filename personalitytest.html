<!DOCTYPE html>
<html lang="en">
<head>
  <title>Personality Quiz • MAUL</title>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta property="og:title" content="Personality Quiz • MAUL" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://moddedamong.us/personalitytest" />
  <meta property="og:image" content="https://moddedamong.us/images/banner.png" />
  <meta property="og:description" content="Modded among us personality test. which role are you?" />
  <meta property="og:site_name" content="Modded Among Us Lobbies" />
  <meta property="og:locale" content="en_US" />
  <link rel="canonical" href="https://moddedamong.us/personalitytest" />
  <meta name="theme-color" content="#120006" />

  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Poppins:wght@500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        integrity="sha512-pcKRe3h4c9VBPlPfwDrLEkHZ90a4q/OzHD7S9vMYI9z1y9u2c7p7x5AcZx/9H84zYZlzGw8c47jM7TCtWbsxkA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

  <style>
    :root{
      --bg0: #050006;
      --bg1: #120007;
      --card: rgba(24, 8, 10, 0.78);
      --card2: rgba(40, 12, 14, 0.72);

      --accent: #8a0000;
      --accent2: #ff0040;
      --accent3: #b00000;

      --text: #ffffff;
      --muted: rgba(235,235,245,0.80);
      --soft: rgba(235,235,245,0.65);

      --border: rgba(255,255,255,0.10);
      --border2: rgba(255,255,255,0.14);

      --shadow: 0 18px 55px rgba(0,0,0,0.85);
      --shadow2: 0 14px 40px rgba(0,0,0,0.80);

      --radius: 18px;
      --radius2: 14px;

      --font: 'Roboto', system-ui, -apple-system, Segoe UI, sans-serif;
      --display: 'Poppins', system-ui, -apple-system, Segoe UI, sans-serif;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body{
      margin: 0;
      font-family: var(--font);
      color: var(--text);
      overflow-x: hidden;
      background: var(--bg0);
    }

    body::before{
      content:"";
      position: fixed;
      inset: 0;
      background:
        radial-gradient(900px 540px at 50% 40%, rgba(138,0,0,0.30), transparent 62%),
        radial-gradient(900px 540px at 50% 85%, rgba(255,0,80,0.10), transparent 70%),
        radial-gradient(circle at 50% 50%, rgba(20,0,8,0.75), rgba(5,0,6,0.96));
      z-index: -3;
    }
    body::after{
      content:"";
      position: fixed;
      inset: 0;
      background-image:
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='220'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='220' height='220' filter='url(%23n)' opacity='.18'/%3E%3C/svg%3E");
      mix-blend-mode: overlay;
      opacity: 0.24;
      pointer-events: none;
      z-index: -2;
    }

    .wrap{
      max-width: 1120px;
      margin: 0 auto;
      padding: 34px 18px 70px;
    }

    .nav{
      position: fixed;
      top: 18px;
      left: 18px;
      z-index: 50;
    }
    .nav-btn{
      width: 54px;
      height: 54px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(20, 8, 10, 0.72);
      backdrop-filter: blur(12px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.75);
      cursor: pointer;
      display: grid;
      place-items: center;
      transition: transform .18s ease, background .18s ease, border-color .18s ease;
    }
    .nav-btn:hover{
      transform: translateY(-1px);
      background: rgba(32, 10, 12, 0.82);
      border-color: rgba(255,255,255,0.18);
    }
    .burger{
      width: 22px;
      height: 16px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .burger span{
      height: 3px;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      box-shadow: 0 0 12px rgba(255,0,80,0.25);
    }

    .nav-menu{
      display: none;
      position: absolute;
      margin-top: 10px;
      min-width: 250px;
      border-radius: 14px;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(20, 8, 10, 0.90);
      box-shadow: 0 16px 50px rgba(0,0,0,0.88);
      backdrop-filter: blur(14px);
    }
    .nav.open .nav-menu { display: block; }
    .nav-menu button{
      width: 100%;
      background: transparent;
      border: 0;
      color: var(--text);
      cursor: pointer;
      padding: 12px 14px;
      text-align: left;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.95rem;
      transition: background .18s ease, padding-left .18s ease, color .18s ease;
    }
    .nav-menu button:hover{
      background: rgba(255,255,255,0.04);
      padding-left: 18px;
      color: #ffd7de;
    }
    .nav-menu .danger:hover{ color: #ff9aa8; }

    .hero{
      min-height: 68vh;
      display: grid;
      place-items: center;
      text-align: center;
      padding: 42px 0 10px;
    }

    .badge{
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.16);
      background: linear-gradient(120deg, rgba(138, 0, 0, 0.45), rgba(255, 0, 80, 0.18));
      box-shadow: 0 12px 32px rgba(0,0,0,0.50);
      color: rgba(255,255,255,0.88);
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-size: 0.78rem;
      backdrop-filter: blur(10px);
    }
    .badge .dot{
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: radial-gradient(circle, #00ff9c, #00b36b);
      box-shadow: 0 0 12px rgba(0,255,156,0.55);
    }

    .title{
      font-family: var(--display);
      margin: 18px 0 0;
      font-size: clamp(2.4rem, 5vw, 4.0rem);
      letter-spacing: 0.02em;
      text-shadow: 0 14px 50px rgba(0,0,0,0.88);
      line-height: 1.08;
    }
    .title .fade{
      color: rgba(255,255,255,0.25);
      font-weight: 700;
      margin: 0 .15em;
    }
    .title .glow{
      background: linear-gradient(120deg, #ffffff 0%, #ffe4ea 22%, rgba(255,0,80,0.88) 60%, rgba(138,0,0,1) 100%);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      filter: drop-shadow(0 10px 28px rgba(255,0,80,0.10));
    }

    .subtitle{
      margin: 14px auto 0;
      max-width: 800px;
      color: var(--muted);
      font-size: 1.02rem;
      line-height: 1.75;
    }
    .subtitle .no-faction{
      color: rgba(255, 60, 90, 0.95);
      font-weight: 700;
    }
    .chips{
      margin-top: 18px;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
    }
    .chip{
      padding: 9px 13px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(24, 8, 10, 0.55);
      color: rgba(255,255,255,0.86);
      font-size: 0.92rem;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 24px rgba(0,0,0,0.55);
    }
    .chip i{ color: rgba(255,255,255,0.82); }
    .chip strong{ color: #fff; font-weight: 700; }

    .actions{
      margin-top: 22px;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 12px;
    }
    .btn{
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(24, 8, 10, 0.60);
      color: var(--text);
      padding: 11px 18px;
      border-radius: 999px;
      cursor: pointer;
      font-weight: 700;
      font-size: 0.96rem;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      transition: transform .18s ease, box-shadow .18s ease, background .18s ease, border-color .18s ease, filter .18s ease;
      box-shadow: 0 12px 32px rgba(0,0,0,0.70);
      backdrop-filter: blur(10px);
    }
    .btn:hover{
      transform: translateY(-1px);
      background: rgba(36, 10, 12, 0.72);
      border-color: rgba(255,255,255,0.22);
      box-shadow: 0 16px 44px rgba(0,0,0,0.82);
    }
    .btn.primary{
      border: 0;
      background: linear-gradient(135deg, var(--accent), var(--accent3));
      box-shadow: 0 16px 46px rgba(0,0,0,0.85), 0 0 0 1px rgba(255,255,255,0.08) inset;
    }
    .btn.primary:hover{ filter: brightness(1.05); }

    .panel{
      max-width: 960px;
      margin: 18px auto 0;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: var(--card);
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      overflow: hidden;
    }
    .panel-head{
      padding: 16px 18px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      background: rgba(0,0,0,0.12);
    }

    .meta{
      display: flex;
      align-items: center;
      gap: 12px;
      color: var(--soft);
      font-size: 0.93rem;
      white-space: nowrap;
    }

    .progress{
      flex: 1;
      min-width: 240px;
      height: 12px;
      border-radius: 999px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.10);
      overflow: hidden;
    }
    .progress > div{
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      box-shadow: 0 0 18px rgba(255,0,80,0.22);
      transition: width .25s ease;
    }

    .panel-body{ padding: 18px; }

    .q-title{
      font-family: var(--display);
      margin: 0;
      font-size: 1.35rem;
      letter-spacing: 0.02em;
    }
    .q-sub{
      margin: 10px 0 0;
      color: var(--muted);
      line-height: 1.65;
      font-size: 0.98rem;
    }

    .answers{
      margin-top: 16px;
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
    }
    @media (max-width: 780px){
      .answers{ grid-template-columns: 1fr; }
      .hero{ min-height: 62vh; padding-top: 55px; }
    }

    .answer{
      text-align: left;
      border-radius: var(--radius2);
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(28, 10, 12, 0.70);
      padding: 14px 14px;
      cursor: pointer;
      transition: transform .16s ease, background .16s ease, border-color .16s ease, box-shadow .16s ease;
      display: flex;
      gap: 12px;
      align-items: flex-start;
      position: relative;
      overflow: hidden;
    }
    .answer::before{
      content:"";
      position:absolute;
      inset:0;
      background: radial-gradient(circle at top left, rgba(255,0,80,0.14), transparent 55%);
      opacity: 0;
      transition: opacity .16s ease;
      pointer-events: none;
    }
    .answer:hover{
      transform: translateY(-2px);
      border-color: rgba(255,255,255,0.18);
      background: rgba(38, 12, 14, 0.78);
      box-shadow: var(--shadow2);
    }
    .answer:hover::before{ opacity: 1; }

    .letter{
      width: 30px;
      height: 30px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: 900;
      background: linear-gradient(135deg, rgba(138,0,0,0.70), rgba(255,0,80,0.35));
      border: 1px solid rgba(255,255,255,0.14);
      box-shadow: 0 10px 22px rgba(0,0,0,0.55);
      flex: 0 0 auto;
      margin-top: 1px;
    }
    .answer .text{
      color: rgba(255,255,255,0.92);
      font-size: 1.0rem;
      line-height: 1.5;
    }

    .panel-foot{
      padding: 14px 18px;
      border-top: 1px solid rgba(255,255,255,0.06);
      display: flex;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
      background: rgba(0,0,0,0.10);
    }

    .result-grid{
      display: grid;
      grid-template-columns: 1.2fr 0.8fr;
      gap: 14px;
      margin-top: 8px;
    }
    @media (max-width: 980px){ .result-grid{ grid-template-columns: 1fr; } }

    .card{
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(28, 10, 12, 0.70);
      padding: 16px;
      box-shadow: 0 14px 42px rgba(0,0,0,0.70);
    }
    .card h3{
      font-family: var(--display);
      margin: 0 0 8px;
      letter-spacing: 0.02em;
    }
    .muted{ color: var(--muted); line-height: 1.7; }

    .tags{ display:flex; flex-wrap:wrap; gap:10px; margin-top:10px; }
    .tag{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.18);
      color: rgba(255,255,255,0.95);
      font-size: 0.92rem;
      box-shadow: 0 10px 22px rgba(0,0,0,0.45);
    }

    .pills{ display:flex; flex-wrap:wrap; gap:10px; margin-top:10px; }
    .pill{
      padding: 9px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(24, 8, 10, 0.55);
      color: rgba(255,255,255,0.86);
      font-size: 0.92rem;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      backdrop-filter: blur(10px);
    }
    .pill strong{ color:#fff; }

    details{
      margin-top: 10px;
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 12px;
      background: rgba(0,0,0,0.14);
      padding: 10px 12px;
    }
    summary{ cursor: pointer; color: var(--soft); }
    pre{
      margin: 10px 0 0;
      white-space: pre-wrap;
      word-break: break-word;
      color: rgba(255,255,255,0.92);
      font-size: 0.90rem;
    }

    .hidden{ display:none !important; }
  </style>
</head>

<body>
  <div class="nav" id="nav">
    <button class="nav-btn" id="navBtn" type="button" aria-label="Menu">
      <div class="burger"><span></span><span></span><span></span></div>
    </button>
    <div class="nav-menu" id="navMenu">
      <button id="menu-save"><i class="fa-regular fa-floppy-disk"></i> Save progress</button>
      <button id="menu-load"><i class="fa-solid fa-rotate"></i> Load progress</button>
      <button id="menu-reset" class="danger"><i class="fa-solid fa-trash"></i> Reset</button>
      <button id="menu-skip"><i class="fa-solid fa-forward"></i> Skip to results (dev)</button>
    </div>
  </div>

  <div class="wrap">
    <section class="hero" id="hero">
      <div>
        <div class="badge">
          <span class="dot"></span>
          <span>Personality Quiz • MAUL</span>
        </div>

        <h1 class="title">
          Find your <span class="glow">Faction</span><span class="fade">.</span>
        </h1>

        <p class="subtitle">
          Answer <strong>24 questions</strong>. We score your playstyle, then match you to a
          <strong>Faction</strong> + <strong>Role</strong> + optional <strong>Add-on</strong>.
          <span class="no-faction">No faction is mentioned in questions</span> — it’s all behavior-based.
        </p>

        <div class="chips">
          <div class="chip"><i class="fa-solid fa-brain"></i> <strong>8</strong> hidden traits</div>
          <div class="chip"><i class="fa-solid fa-masks-theater"></i> Archetype → Role</div>
          <div class="chip"><i class="fa-solid fa-shield-heart"></i> Explanations </div>
        </div>

        <div class="actions">
          <button id="btn-start" class="btn primary"><i class="fa-solid fa-play"></i> Start Quiz</button>
          <button id="btn-load" class="btn"><i class="fa-solid fa-rotate"></i> Load</button>
        </div>
      </div>
    </section>

    <section id="quizPanel" class="panel hidden">
      <div class="panel-head">
        <div class="progress" aria-label="Progress"><div id="progressBar"></div></div>
        <div class="meta">
          <span id="qIndexText">Q 1 / 24</span>
          <span>•</span>
          <span id="autosaveText">Autosave: ON</span>
        </div>
      </div>

      <div class="panel-body">
        <h2 id="qTitle" class="q-title">Question</h2>
        <p id="qSub" class="q-sub">Pick what fits you best.</p>
        <div id="answers" class="answers"></div>
      </div>

      <div class="panel-foot">
        <button id="btn-back" class="btn"><i class="fa-solid fa-arrow-left"></i> Back</button>
        <button id="btn-reset" class="btn"><i class="fa-solid fa-trash"></i> Reset</button>
      </div>
    </section>

    <section id="resultPanel" class="panel hidden">
      <div class="panel-head">
        <div class="meta"><span><i class="fa-solid fa-award"></i> Your result</span></div>
        <div class="meta">
          <button id="btn-reroll" class="btn"><i class="fa-solid fa-dice"></i> Reroll add-on</button>
          <button id="btn-restart" class="btn primary"><i class="fa-solid fa-rotate-right"></i> Restart</button>
        </div>
      </div>

      <div class="panel-body">
        <div class="result-grid">
          <div class="card">
            <h3 id="resultHeadline">You are: ???</h3>

            <div class="tags">
              <span class="tag" id="tagFaction"><i class="fa-solid fa-flag"></i> Faction: ???</span>
              <span class="tag" id="tagRole"><i class="fa-solid fa-user-secret"></i> Role: ???</span>
              <span class="tag" id="tagAddon"><i class="fa-solid fa-puzzle-piece"></i> Add-on: (none)</span>
            </div>

            <p id="resultMeaning" class="muted" style="margin-top:12px;"></p>

            <h4 style="margin:14px 0 8px; font-family: var(--display); letter-spacing: 0.02em;">
              Why you got this
            </h4>
            <div id="whyPills" class="pills"></div>
          </div>

          <div class="card">
            <h3>Trait Snapshot</h3>
            <p class="muted" style="margin:0 0 10px;">
              <b>Remove in prod</b>>
            </p>

            <details>
              <summary>Show trait math</summary>
              <pre id="debugOut"></pre>
            </details>

            <details>
              <summary>How matching works (short)</summary>
              <p class="muted" style="margin-top:10px;">
                make this easier to understand later Answers build an 8-trait profile. We match the closest archetype,
                then pick a faction with weighted odds. Roles are matched by their own target profile when available.
              </p>
            </details>
          </div>
        </div>
      </div>

      <div class="panel-foot">
        <span class="muted" style="font-size:0.92rem;">
          Made with ❤️ By MAUL.
        </span>
      </div>
    </section>
  </div>

  <script>
    const TRAIT_KEYS = ["aggression","strategy","social","visibility","control","risk","loyalty","power"];
    const defaultTraits = () => Object.fromEntries(TRAIT_KEYS.map(k => [k, 0]));

    const questions = [
      { text:"A game gets quiet. What do you do?", sub:"Think about how you create momentum.", answers:[
        { text:"Force action immediately, even if it’s risky.", effects:{ aggression:+2, risk:+1, visibility:+1 } },
        { text:"Wait for the perfect moment to act.", effects:{ strategy:+2, visibility:-1 } },
        { text:"Nudge others into making mistakes.", effects:{ social:+2, control:+1 } },
        { text:"Stay hidden and gather info first.", effects:{ visibility:-2, strategy:+1 } },
      ]},
      { text:"You get a chance to remove someone. How do you prefer it?", sub:"This is about your style, not your faction.", answers:[
        { text:"Direct and fast. Minimal fuss.", effects:{ aggression:+2, strategy:-1 } },
        { text:"Only if it advances a bigger plan.", effects:{ strategy:+2, control:+1 } },
        { text:"If it causes confusion and blame.", effects:{ social:+1, control:+1, risk:+1 } },
        { text:"I’d rather avoid it unless forced.", effects:{ aggression:-2, risk:-1, loyalty:+1 } },
      ]},
      { text:"Your ideal pressure level mid-round is…", sub:"", answers:[
        { text:"High. I like constant tension.", effects:{ aggression:+1, risk:+1, power:+1 } },
        { text:"Medium. Controlled pace is best.", effects:{ strategy:+1, control:+1 } },
        { text:"Low. I want time to read people.", effects:{ strategy:+1, visibility:-1 } },
        { text:"Unpredictable. Keep everyone guessing.", effects:{ risk:+2, social:+1 } },
      ]},
      { text:"If someone is in your way, you usually…", sub:"", answers:[
        { text:"Remove the obstacle.", effects:{ aggression:+2, control:+1 } },
        { text:"Outmaneuver them socially.", effects:{ social:+2, strategy:+1 } },
        { text:"Wait and let them trip up.", effects:{ strategy:+2, visibility:-1 } },
        { text:"Switch targets; not worth it.", effects:{ risk:-1, control:-1, loyalty:+1 } },
      ]},
      { text:"When you fail an attempt, your next move is…", sub:"", answers:[
        { text:"Double down. Speed matters.", effects:{ aggression:+1, risk:+2 } },
        { text:"Adapt the plan calmly.", effects:{ strategy:+2, control:+1 } },
        { text:"Turn it into a story to sell.", effects:{ social:+2, visibility:+1 } },
        { text:"Back off and reset quietly.", effects:{ visibility:-2, risk:-1 } },
      ]},
      { text:"What kind of “power” feels best?", sub:"", answers:[
        { text:"The kind that ends games.", effects:{ power:+2, aggression:+1 } },
        { text:"The kind that controls outcomes.", effects:{ control:+2, strategy:+1 } },
        { text:"The kind that shapes conversation.", effects:{ social:+2, visibility:+1 } },
        { text:"The kind that protects or supports.", effects:{ loyalty:+2, power:-1 } },
      ]},
      { text:"During meetings, you’re usually…", sub:"", answers:[
        { text:"Leading the conversation.", effects:{ social:+2, control:+1, visibility:+1 } },
        { text:"Dropping key facts only.", effects:{ strategy:+2, visibility:-1 } },
        { text:"Sowing doubt and redirecting.", effects:{ social:+2, control:+1, risk:+1 } },
        { text:"Quiet, watching who speaks.", effects:{ visibility:-2, strategy:+1 } },
      ]},
      { text:"Someone accuses you. Your instinct is…", sub:"", answers:[
        { text:"Confront them hard.", effects:{ aggression:+2, visibility:+1 } },
        { text:"Turn suspicion elsewhere smoothly.", effects:{ social:+2, control:+1 } },
        { text:"Lean into it to confuse the room.", effects:{ risk:+2, social:+1, visibility:+1 } },
        { text:"Say little; let evidence fade.", effects:{ visibility:-2, strategy:+1 } },
      ]},
      { text:"You trust information that is…", sub:"", answers:[
        { text:"Direct and obvious.", effects:{ visibility:+2, strategy:-1 } },
        { text:"Verified by patterns.", effects:{ strategy:+2 } },
        { text:"Useful, even if incomplete.", effects:{ control:+1, strategy:+1 } },
        { text:"Mostly a tool to influence people.", effects:{ social:+2, control:+1 } },
      ]},
      { text:"Your favorite social move is…", sub:"", answers:[
        { text:"Build an ally and stick with them.", effects:{ loyalty:+2, social:+1 } },
        { text:"Play independent; no attachments.", effects:{ loyalty:-2, visibility:-1 } },
        { text:"Collect influence across everyone.", effects:{ social:+2, control:+1 } },
        { text:"Stay neutral and dodge drama.", effects:{ risk:-1, visibility:-1, strategy:+1 } },
      ]},
      { text:"When someone is obviously wrong, you…", sub:"", answers:[
        { text:"Correct them instantly.", effects:{ visibility:+2, control:+1 } },
        { text:"Let them keep talking (it’s useful).", effects:{ strategy:+1, social:+1, control:+1 } },
        { text:"Exploit it to steer decisions.", effects:{ social:+2, control:+2 } },
        { text:"Avoid it; it attracts attention.", effects:{ visibility:-2, risk:-1 } },
      ]},
      { text:"If you could choose, your reputation would be…", sub:"", answers:[
        { text:"Fearless and dangerous.", effects:{ aggression:+2, power:+1 } },
        { text:"Reliable and helpful.", effects:{ loyalty:+2, power:-1 } },
        { text:"Impossible to read.", effects:{ visibility:-2, strategy:+1 } },
        { text:"Always in control.", effects:{ control:+2, social:+1 } },
      ]},
      { text:"You prefer abilities that…", sub:"", answers:[
        { text:"Remove threats quickly.", effects:{ aggression:+2, power:+1 } },
        { text:"Lock down the game’s pace.", effects:{ control:+2, strategy:+1 } },
        { text:"Mess with what people believe.", effects:{ social:+2, control:+1 } },
        { text:"Scale stronger over time.", effects:{ strategy:+2, power:+1 } },
      ]},
      { text:"When given a limited-use tool, you…", sub:"", answers:[
        { text:"Use it early to build tempo.", effects:{ risk:+1, aggression:+1, visibility:+1 } },
        { text:"Save it for a guaranteed swing.", effects:{ strategy:+2, control:+1 } },
        { text:"Use it to create uncertainty.", effects:{ social:+1, risk:+1, control:+1 } },
        { text:"Use it only to protect yourself.", effects:{ risk:-1, loyalty:-1, visibility:-1 } },
      ]},
      { text:"You feel most powerful when…", sub:"", answers:[
        { text:"People have to react to you.", effects:{ control:+2, visibility:+1 } },
        { text:"No one knows you’re behind it.", effects:{ visibility:-2, strategy:+1 } },
        { text:"You can carry the endgame.", effects:{ power:+2, loyalty:-1 } },
        { text:"Your team feels safe because of you.", effects:{ loyalty:+2, power:-1 } },
      ]},
      { text:"Your decision-making style is…", sub:"", answers:[
        { text:"Snap judgments.", effects:{ strategy:-1, risk:+2 } },
        { text:"Evidence-first.", effects:{ strategy:+2, risk:-1 } },
        { text:"People-first.", effects:{ social:+2, strategy:+1 } },
        { text:"Control-first.", effects:{ control:+2, strategy:+1 } },
      ]},
      { text:"If you can “force” something, you…", sub:"", answers:[
        { text:"Force it immediately.", effects:{ control:+1, risk:+2, aggression:+1 } },
        { text:"Force it only when it’s clean.", effects:{ strategy:+2, control:+1 } },
        { text:"Force it socially, not directly.", effects:{ social:+2, control:+1 } },
        { text:"Avoid forcing; it’s messy.", effects:{ risk:-1, visibility:-1, loyalty:+1 } },
      ]},
      { text:"When a plan needs someone else’s cooperation, you…", sub:"", answers:[
        { text:"Persuade them.", effects:{ social:+2, control:+1 } },
        { text:"Pressure them.", effects:{ control:+2, visibility:+1 } },
        { text:"Bait them into choosing it.", effects:{ strategy:+1, social:+1, visibility:-1 } },
        { text:"Abandon it; too many variables.", effects:{ strategy:+1, risk:-1, loyalty:-1 } },
      ]},
      { text:"Your best games feel like…", sub:"", answers:[
        { text:"A clean plan executed perfectly.", effects:{ strategy:+2, control:+1 } },
        { text:"A chaotic ride that you survive.", effects:{ risk:+2, visibility:+1 } },
        { text:"A social puzzle you solved.", effects:{ social:+2, strategy:+1 } },
        { text:"A duel where you outfight everyone.", effects:{ aggression:+2, power:+1 } },
      ]},
      { text:"You’re most comfortable when…", sub:"", answers:[
        { text:"You have a route and timing.", effects:{ strategy:+2, visibility:-1 } },
        { text:"You can improvise freely.", effects:{ risk:+2, strategy:-1 } },
        { text:"You can control the room.", effects:{ control:+2, social:+1 } },
        { text:"You have a trusted ally.", effects:{ loyalty:+2, social:+1 } },
      ]},
      { text:"If you had to pick, you’d rather be…", sub:"", answers:[
        { text:"Underestimated.", effects:{ visibility:-2, strategy:+1 } },
        { text:"Feared.", effects:{ aggression:+2, visibility:+1 } },
        { text:"Respected.", effects:{ social:+1, loyalty:+1, control:+1 } },
        { text:"Unpredictable.", effects:{ risk:+2, social:+1 } },
      ]},
      { text:"When you take a risk, it’s usually because…", sub:"", answers:[
        { text:"You want to end things fast.", effects:{ risk:+2, aggression:+1 } },
        { text:"The math says it’s worth it.", effects:{ strategy:+2, risk:+1 } },
        { text:"You can talk your way out later.", effects:{ social:+2, risk:+1 } },
        { text:"You don’t. You avoid risks.", effects:{ risk:-2, strategy:+1 } },
      ]},
      { text:"In endgame, your priority is…", sub:"", answers:[
        { text:"Carry and finish.", effects:{ power:+2, aggression:+1 } },
        { text:"Control the last decisions.", effects:{ control:+2, social:+1 } },
        { text:"Stay alive at all costs.", effects:{ risk:-1, visibility:-1, strategy:+1 } },
        { text:"Win with allies if possible.", effects:{ loyalty:+2, social:+1 } },
      ]},
      { text:"If you’re behind, you…", sub:"", answers:[
        { text:"Make a bold swing.", effects:{ risk:+2, visibility:+1 } },
        { text:"Rebuild slowly with a plan.", effects:{ strategy:+2, control:+1 } },
        { text:"Shift the narrative.", effects:{ social:+2, control:+1 } },
        { text:"Disengage and survive longer.", effects:{ visibility:-2, risk:-1 } },
      ]},
    ];

    const archetypes = [
      { id:"aggressive_carry", name:"Aggressive Carry",
        target:{ aggression:7, power:6, risk:4, strategy:2, social:1, visibility:2, control:1, loyalty:-1 },
        factionBias:{ impostor:1.0, neutral:1.0, coven:0.9, crewmate:0.6 },
        meaning:"You like direct impact. You create pressure and you’re willing to take fights to close the game." },
      { id:"stealth_operator", name:"Stealth Operator",
        target:{ visibility:-7, strategy:5, control:3, risk:2, social:1, aggression:1, loyalty:0, power:1 },
        factionBias:{ impostor:1.1, neutral:1.0, coven:0.9, crewmate:0.8 },
        meaning:"You win by being hard to read. You move quietly, pick clean moments, and avoid unnecessary spotlight." },
      { id:"social_controller", name:"Social Controller",
        target:{ social:7, control:6, strategy:4, visibility:2, risk:2, aggression:1, loyalty:0, power:1 },
        factionBias:{ impostor:1.0, coven:1.0, crewmate:0.9, neutral:0.8 },
        meaning:"You shape decisions. You steer meetings, influence alliances, and turn small moments into big outcomes." },
      { id:"strategic_director", name:"Strategic Director",
        target:{ strategy:8, control:5, visibility:-1, risk:0, social:2, aggression:0, loyalty:1, power:1 },
        factionBias:{ crewmate:1.0, coven:1.0, impostor:0.9, neutral:0.8 },
        meaning:"You value clean planning. You like reliable lines, timing windows, and measured decisions." },
      { id:"support_guardian", name:"Support Guardian",
        target:{ loyalty:8, power:-2, strategy:3, risk:-2, social:2, control:1, visibility:0, aggression:-2 },
        factionBias:{ crewmate:1.2, coven:0.8, impostor:0.5, neutral:0.7 },
        meaning:"You prefer stability. You protect, enable, and keep the game structured so others can succeed." },
      { id:"chaotic_wildcard", name:"Chaotic Wildcard",
        target:{ risk:8, strategy:-1, social:3, visibility:2, aggression:2, control:1, loyalty:-1, power:1 },
        factionBias:{ neutral:1.2, impostor:0.9, coven:0.9, crewmate:0.8 },
        meaning:"You thrive in uncertainty. You like unusual lines, bold plays, and forcing the lobby to adapt." },
    ];

    const baseRolePool = [
      { id:"detective", name:"Investigator", faction:"crewmate", archetype:["strategic_director"], weight:1.0,
        meaning:"You’re an information-first player. You win by verifying patterns, catching contradictions, and making clean calls.",
        target:{ aggression:0, strategy:7, social:1, visibility:0, control:2, risk:-1, loyalty:4, power:0 } },

      { id:"guardian", name:"Bodyguard", faction:"crewmate", archetype:["support_guardian"], weight:1.0,
        meaning:"You focus on protecting key players and preventing snowballs. You stabilize the round for your team.",
        target:{ aggression:-2, strategy:3, social:2, visibility:0, control:1, risk:-2, loyalty:8, power:-1 } },

      { id:"leader", name:"Mayor", faction:"crewmate", archetype:["social_controller","strategic_director"], weight:0.9,
        meaning:"You influence decisions in meetings and help coordinate the team’s direction.",
        target:{ aggression:0, strategy:6, social:6, visibility:2, control:6, risk:0, loyalty:5, power:0 } },

      { id:"analyst", name:"Analyst", faction:"crewmate", archetype:["strategic_director"], weight:0.9,
        meaning:"You like structure and logic. You’re strong at narrowing possibilities and keeping discussions grounded.",
        target:{ aggression:-1, strategy:8, social:1, visibility:-1, control:4, risk:-1, loyalty:4, power:0 } },

      { id:"camouflage", name:"Camouflager", faction:"impostor", archetype:["stealth_operator","social_controller"], weight:1.0,
        meaning:"You prefer misdirection over brute force. You like making the lobby question what they saw.",
        target:{ aggression:2, strategy:5, social:3, visibility:-5, control:3, risk:2, loyalty:-4, power:2 } },

      { id:"framer", name:"Framer", faction:"impostor", archetype:["social_controller"], weight:0.95,
        meaning:"You win by creating believable blame. You turn small details into convincing narratives.",
        target:{ aggression:1, strategy:5, social:7, visibility:1, control:6, risk:2, loyalty:-5, power:2 } },

      { id:"ninja", name:"Ninja", faction:"impostor", archetype:["stealth_operator"], weight:1.0,
        meaning:"You prefer clean, unseen impact. You pick moments where you can act without leaving obvious trails.",
        target:{ aggression:3, strategy:6, social:1, visibility:-7, control:2, risk:2, loyalty:-6, power:3 } },

      { id:"bomber", name:"Bomber", faction:"impostor", archetype:["chaotic_wildcard","aggressive_carry"], weight:0.85,
        meaning:"You like high-pressure rounds. You force movement, panic, and difficult choices.",
        target:{ aggression:5, strategy:3, social:2, visibility:2, control:3, risk:8, loyalty:-6, power:4 } },

      { id:"opportunist", name:"Opportunist", faction:"neutral", archetype:["support_guardian","stealth_operator"], weight:1.0,
        meaning:"You play for survival and smart positioning. You let other factions clash while you stay safe.",
        target:{ aggression:-4, strategy:3, social:1, visibility:-2, control:0, risk:-2, loyalty:4, power:1 } },

      { id:"jester", name:"Jester", faction:"neutral", archetype:["chaotic_wildcard","social_controller"], weight:1.0,
        meaning:"You win by social chaos. You thrive on confusion, baiting reactions, and unpredictable behavior.",
        target:{ aggression:-2, strategy:2, social:8, visibility:5, control:3, risk:6, loyalty:-8, power:6 } },

      { id:"juggernaut", name:"Juggernaut", faction:"neutral", archetype:["aggressive_carry"], weight:0.95,
        meaning:"You’re a snowball threat. You focus on momentum and turning one win into the next.",
        target:{ aggression:8, strategy:2, social:-2, visibility:0, control:1, risk:3, loyalty:-7, power:7 } },

      { id:"collector", name:"Collector", faction:"neutral", archetype:["strategic_director","social_controller"], weight:0.85,
        meaning:"You win through meetings and alignment with group decisions. You track votes and optimize outcomes.",
        target:{ aggression:-2, strategy:4, social:7, visibility:2, control:5, risk:1, loyalty:-6, power:6 } },

      { id:"covenleader", name:"Coven Leader", faction:"coven", archetype:["strategic_director","social_controller"], weight:1.0,
        meaning:"You like structured control. You prefer coordinated plays that steadily reduce the lobby’s options.",
        target:{ aggression:5, strategy:5, social:1, visibility:0, control:6, risk:1, loyalty:8, power:6 } },

      { id:"illusionist", name:"Illusionist", faction:"coven", archetype:["social_controller","stealth_operator"], weight:0.95,
        meaning:"You manipulate perception. You enjoy turning certainty into doubt and making reads unreliable.",
        target:{ aggression:1, strategy:7, social:2, visibility:-4, control:5, risk:2, loyalty:6, power:4 } },

      { id:"timelord", name:"Timelord", faction:"coven", archetype:["strategic_director"], weight:0.9,
        meaning:"You manage pacing and cooldown timing. You’re strongest when you can orchestrate the tempo.",
        target:{ aggression:1, strategy:7, social:1, visibility:-1, control:9, risk:2, loyalty:7, power:5 } },

      { id:"voodoo", name:"Voodoo Master", faction:"coven", archetype:["social_controller","chaotic_wildcard"], weight:0.85,
        meaning:"You love indirect influence. You create moments where other players’ actions spiral into advantage.",
        target:{ aggression:1, strategy:6, social:1, visibility:-1, control:9, risk:3, loyalty:6, power:4 } },
    ];
    const extraRolePool = [
      {
        "id": "soul_collector",
        "name": "Soul Collector",
        "faction": "neutral",
        "tags": ["killer", "delayed", "hidden-body", "stealth"],
        "target": { "aggression": 6, "strategy": 5, "social": -1, "visibility": -5, "control": 2, "risk": 1, "loyalty": -6, "power": 4 },
        "weight": 1.2
      },
      {
        "id": "samurai",
        "name": "Samurai",
        "faction": "neutral",
        "tags": ["killer", "delayed", "tempo", "precision"],
        "target": { "aggression": 6, "strategy": 6, "social": -2, "visibility": -2, "control": 1, "risk": 2, "loyalty": -6, "power": 4 },
        "weight": 1.1
      },
      {
        "id": "weatherman",
        "name": "Weatherman",
        "faction": "neutral",
        "tags": ["killer", "area-control", "chaos", "disaster"],
        "target": { "aggression": 5, "strategy": 3, "social": -1, "visibility": 1, "control": 6, "risk": 4, "loyalty": -6, "power": 5 },
        "weight": 1.1
      },
      {
        "id": "blood_knight",
        "name": "Blood Knight",
        "faction": "neutral",
        "tags": ["killer", "shield", "duelist", "snowball"],
        "target": { "aggression": 7, "strategy": 2, "social": -2, "visibility": 0, "control": 0, "risk": 2, "loyalty": -5, "power": 6 },
        "weight": 1.2
      },
      {
        "id": "bubble",
        "name": "Bubble",
        "faction": "neutral",
        "tags": ["killer", "delayed", "aoe", "trap"],
        "target": { "aggression": 6, "strategy": 5, "social": -1, "visibility": 1, "control": 5, "risk": 3, "loyalty": -6, "power": 5 },
        "weight": 1.2
      },
      {
        "id": "evolver",
        "name": "Evolver",
        "faction": "neutral",
        "tags": ["killer", "scaling", "upgrade", "adaptation"],
        "target": { "aggression": 5, "strategy": 6, "social": -1, "visibility": 0, "control": 3, "risk": 2, "loyalty": -6, "power": 6 },
        "weight": 1.2
      },
      {
        "id": "eclipse",
        "name": "Eclipse",
        "faction": "neutral",
        "tags": ["killer", "scaling", "snowball", "vision"],
        "target": { "aggression": 6, "strategy": 3, "social": -2, "visibility": -1, "control": 0, "risk": 2, "loyalty": -6, "power": 6 },
        "weight": 1.0
      },
      {
        "id": "cherokious",
        "name": "Cherokious",
        "faction": "neutral",
        "tags": ["killer", "resource", "tasks", "ammo"],
        "target": { "aggression": 5, "strategy": 6, "social": -2, "visibility": -2, "control": 1, "risk": 1, "loyalty": -5, "power": 4 },
        "weight": 1.0
      },
      {
        "id": "vortex",
        "name": "Vortex",
        "faction": "neutral",
        "tags": ["killer", "body-control", "vents", "stealth"],
        "target": { "aggression": 6, "strategy": 6, "social": -2, "visibility": -5, "control": 4, "risk": 2, "loyalty": -6, "power": 4 },
        "weight": 1.1
      },
      {
        "id": "werewolf",
        "name": "Werewolf",
        "faction": "neutral",
        "tags": ["killer", "burst", "rampage", "tempo"],
        "target": { "aggression": 8, "strategy": 3, "social": -2, "visibility": 0, "control": 1, "risk": 4, "loyalty": -6, "power": 6 },
        "weight": 1.2
      },
      {
        "id": "wraith",
        "name": "Wraith",
        "faction": "neutral",
        "tags": ["killer", "stealth", "invisible"],
        "target": { "aggression": 6, "strategy": 4, "social": -2, "visibility": -6, "control": 1, "risk": 2, "loyalty": -6, "power": 4 },
        "weight": 1.1
      },
      {
        "id": "patroller",
        "name": "Patroller",
        "faction": "neutral",
        "tags": ["killer", "map-control", "room-bonus", "tempo"],
        "target": { "aggression": 6, "strategy": 5, "social": -1, "visibility": -1, "control": 3, "risk": 2, "loyalty": -6, "power": 4 },
        "weight": 1.0
      },
      {
        "id": "bandit",
        "name": "Bandit",
        "faction": "neutral",
        "tags": ["utility", "steal", "addon-control", "tempo"],
        "target": { "aggression": 3, "strategy": 5, "social": 1, "visibility": -1, "control": 6, "risk": 2, "loyalty": -5, "power": 4 },
        "weight": 1.0
      },
      {
        "id": "nonplus",
        "name": "Nonplus",
        "faction": "neutral",
        "tags": ["killer", "debuff", "blind", "control"],
        "target": { "aggression": 5, "strategy": 4, "social": -1, "visibility": -2, "control": 7, "risk": 2, "loyalty": -6, "power": 4 },
        "weight": 1.0
      },
      {
        "id": "agitator",
        "name": "Agitator",
        "faction": "neutral",
        "tags": ["killer", "bomb", "pass", "chaos"],
        "target": { "aggression": 5, "strategy": 4, "social": 3, "visibility": 2, "control": 5, "risk": 6, "loyalty": -6, "power": 4 },
        "weight": 1.1
      },
      {
        "id": "jinx",
        "name": "Jinx",
        "faction": "neutral",
        "tags": ["killer", "counter", "trap", "punish"],
        "target": { "aggression": 4, "strategy": 4, "social": -2, "visibility": -2, "control": 5, "risk": 2, "loyalty": -6, "power": 5 },
        "weight": 1.0
      },
      {
        "id": "poisoner",
        "name": "Poisoner",
        "faction": "neutral",
        "tags": ["killer", "delayed", "stealth", "double-click"],
        "target": { "aggression": 5, "strategy": 6, "social": -2, "visibility": -4, "control": 3, "risk": 2, "loyalty": -6, "power": 4 },
        "weight": 1.0
      },
      {
        "id": "vector",
        "name": "Vector",
        "faction": "neutral",
        "tags": ["evil", "objective", "vents", "grind"],
        "target": { "aggression": -2, "strategy": 6, "social": -1, "visibility": -2, "control": 1, "risk": 1, "loyalty": -4, "power": 5 },
        "weight": 1.0
      },
      {
        "id": "collector",
        "name": "Collector",
        "faction": "neutral",
        "tags": ["evil", "meeting", "votes", "math"],
        "target": { "aggression": -2, "strategy": 4, "social": 7, "visibility": 2, "control": 5, "risk": 1, "loyalty": -6, "power": 6 },
        "weight": 1.2
      },
      {
        "id": "doomsayer",
        "name": "Doomsayer",
        "faction": "neutral",
        "tags": ["evil", "guessing", "win-trigger", "high-stakes"],
        "target": { "aggression": 1, "strategy": 6, "social": 4, "visibility": 2, "control": 4, "risk": 5, "loyalty": -8, "power": 7 },
        "weight": 1.3
      },
      {
        "id": "gaslighter",
        "name": "Gaslighter",
        "faction": "neutral",
        "tags": ["evil", "cycle", "multi-tool", "support-control"],
        "target": { "aggression": 2, "strategy": 4, "social": 4, "visibility": 1, "control": 7, "risk": 2, "loyalty": -6, "power": 5 },
        "weight": 1.1
      },
      {
        "id": "jester",
        "name": "Jester",
        "faction": "neutral",
        "tags": ["evil", "self-eject", "social", "chaos"],
        "target": { "aggression": -2, "strategy": 2, "social": 8, "visibility": 5, "control": 3, "risk": 6, "loyalty": -8, "power": 6 },
        "weight": 1.4
      },
      {
        "id": "traitor",
        "name": "Traitor",
        "faction": "neutral",
        "tags": ["killer", "info", "anti-impostor", "solo-win"],
        "target": { "aggression": 6, "strategy": 5, "social": 1, "visibility": 0, "control": 2, "risk": 2, "loyalty": -8, "power": 6 },
        "weight": 1.1
      },
      {
        "id": "innocent",
        "name": "Innocent",
        "faction": "neutral",
        "tags": ["evil", "frame", "self-sacrifice", "meeting"],
        "target": { "aggression": 0, "strategy": 5, "social": 7, "visibility": 3, "control": 4, "risk": 7, "loyalty": -6, "power": 5 },
        "weight": 1.1
      },
      {
        "id": "executioner",
        "name": "Executioner",
        "faction": "neutral",
        "tags": ["evil", "target", "meeting", "social"],
        "target": { "aggression": -1, "strategy": 5, "social": 7, "visibility": 1, "control": 4, "risk": 2, "loyalty": -6, "power": 6 },
        "weight": 1.1
      },
      {
        "id": "magistrate",
        "name": "Magistrate",
        "faction": "neutral",
        "tags": ["pariah", "meeting", "court", "extra-votes"],
        "target": { "aggression": 0, "strategy": 3, "social": 5, "visibility": 4, "control": 8, "risk": 2, "loyalty": -2, "power": 6 },
        "weight": 1.0
      },
      {
        "id": "curser",
        "name": "Curser",
        "faction": "neutral",
        "tags": ["pariah", "debuff", "reveal-alignment", "control"],
        "target": { "aggression": -1, "strategy": 4, "social": 1, "visibility": -1, "control": 8, "risk": 2, "loyalty": -2, "power": 4 },
        "weight": 1.0
      },
      {
        "id": "clerk",
        "name": "Clerk",
        "faction": "neutral",
        "tags": ["pariah", "tax", "meeting", "punish"],
        "target": { "aggression": -1, "strategy": 5, "social": 3, "visibility": 1, "control": 6, "risk": 3, "loyalty": -1, "power": 4 },
        "weight": 1.0
      },
      {
        "id": "spirit",
        "name": "Spirit",
        "faction": "neutral",
        "tags": ["pariah", "swap", "redirect", "control"],
        "target": { "aggression": -2, "strategy": 5, "social": 1, "visibility": -1, "control": 8, "risk": 2, "loyalty": 1, "power": 4 },
        "weight": 1.0
      },
      {
        "id": "auditor",
        "name": "Auditor",
        "faction": "neutral",
        "tags": ["pariah", "reveal", "charges", "smokebomb"],
        "target": { "aggression": -1, "strategy": 6, "social": 1, "visibility": -1, "control": 7, "risk": 1, "loyalty": 0, "power": 4 },
        "weight": 1.0
      },
      {
        "id": "starspawn",
        "name": "Starspawn",
        "faction": "neutral",
        "tags": ["pariah", "daybreak", "meeting-control", "isolate"],
        "target": { "aggression": 0, "strategy": 5, "social": 2, "visibility": 1, "control": 8, "risk": 2, "loyalty": 0, "power": 5 },
        "weight": 1.0
      },
      {
        "id": "shifter",
        "name": "Shifter",
        "faction": "neutral",
        "tags": ["benign", "role-swap", "identity", "support"],
        "target": { "aggression": -3, "strategy": 5, "social": 1, "visibility": -1, "control": 3, "risk": 2, "loyalty": 4, "power": 0 },
        "weight": 1.0
      },
      {
        "id": "pursuer",
        "name": "Pursuer",
        "faction": "neutral",
        "tags": ["benign", "blank-shot", "counter", "support"],
        "target": { "aggression": -3, "strategy": 6, "social": 1, "visibility": -2, "control": 5, "risk": -1, "loyalty": 6, "power": 0 },
        "weight": 1.0
      },
      {
        "id": "specter",
        "name": "Specter",
        "faction": "neutral",
        "tags": ["benign", "tasks", "death-required", "survive-end"],
        "target": { "aggression": -4, "strategy": 4, "social": -1, "visibility": -1, "control": 0, "risk": 1, "loyalty": 6, "power": 1 },
        "weight": 1.0
      },
      {
        "id": "postman",
        "name": "Postman",
        "faction": "neutral",
        "tags": ["benign", "objective", "targeted", "risk"],
        "target": { "aggression": -3, "strategy": 6, "social": 1, "visibility": -1, "control": 1, "risk": 4, "loyalty": 4, "power": 2 },
        "weight": 1.0
      },
      {
        "id": "opportunist",
        "name": "Opportunist",
        "faction": "neutral",
        "tags": ["benign", "survive", "low-profile"],
        "target": { "aggression": -4, "strategy": 3, "social": 1, "visibility": -2, "control": 0, "risk": -2, "loyalty": 4, "power": 1 },
        "weight": 1.1
      },
      {
        "id": "necro_guesser",
        "name": "Necro-Guesser",
        "faction": "neutral",
        "tags": ["benign", "guessing", "dead-only", "objective"],
        "target": { "aggression": -3, "strategy": 7, "social": 2, "visibility": 0, "control": 2, "risk": 1, "loyalty": 3, "power": 3 },
        "weight": 1.0
      },
      {
        "id": "maverick",
        "name": "Maverick",
        "faction": "neutral",
        "tags": ["benign", "killer", "quota", "survive"],
        "target": { "aggression": 3, "strategy": 4, "social": -1, "visibility": -1, "control": 1, "risk": 1, "loyalty": 2, "power": 3 },
        "weight": 1.0
      },
      {
        "id": "schrodingers_cat",
        "name": "Schrödinger's Cat",
        "faction": "neutral",
        "tags": ["benign", "counter", "adapt", "survive"],
        "target": { "aggression": -2, "strategy": 5, "social": 0, "visibility": -1, "control": 3, "risk": 2, "loyalty": 2, "power": 2 },
        "weight": 1.0
      },
      {
        "id": "investor",
        "name": "Investor",
        "faction": "neutral",
        "tags": ["benign", "mark", "win-with-others", "social"],
        "target": { "aggression": -3, "strategy": 6, "social": 3, "visibility": 0, "control": 2, "risk": 0, "loyalty": 6, "power": 1 },
        "weight": 1.0
      },
      {
        "id": "hater",
        "name": "Hater",
        "faction": "neutral",
        "tags": ["benign", "killer", "restricted", "misfire"],
        "target": { "aggression": 4, "strategy": 4, "social": -2, "visibility": -1, "control": 1, "risk": 7, "loyalty": 2, "power": 2 },
        "weight": 1.0
      },
      {
        "id": "pestilence",
        "name": "Pestilence",
        "faction": "neutral",
        "tags": ["killer", "immortal", "counter", "touch-kills"],
        "target": { "aggression": 7, "strategy": 4, "social": -3, "visibility": 0, "control": 6, "risk": 1, "loyalty": -6, "power": 8 },
        "weight": 1.3
      },
      {
        "id": "dealer",
        "name": "Dealer",
        "faction": "neutral",
        "tags": ["benign", "utility", "addons", "objective"],
        "target": { "aggression": -4, "strategy": 5, "social": 2, "visibility": -1, "control": 4, "risk": 1, "loyalty": 6, "power": 0 },
        "weight": 1.0
      },
      {
        "id": "backstabber",
        "name": "Backstabber",
        "faction": "neutral",
        "tags": ["benign", "killer", "one-shot", "win-shift"],
        "target": { "aggression": 2, "strategy": 5, "social": 1, "visibility": -1, "control": 2, "risk": 4, "loyalty": -2, "power": 4 },
        "weight": 1.0
      },
      {
        "id": "god",
        "name": "God",
        "faction": "neutral",
        "tags": ["chaos", "info", "solo-survive", "high-power"],
        "target": { "aggression": -3, "strategy": 7, "social": 1, "visibility": 0, "control": 4, "risk": 0, "loyalty": -4, "power": 7 },
        "weight": 1.2
      },
      {
        "id": "provocateur",
        "name": "Provocateur",
        "faction": "neutral",
        "tags": ["benign", "killer", "one-shot", "target-lose"],
        "target": { "aggression": 1, "strategy": 6, "social": 2, "visibility": -1, "control": 2, "risk": 4, "loyalty": 2, "power": 3 },
        "weight": 1.0
      },

      {
        "id": "voodoo_master",
        "name": "Voodoo Master",
        "faction": "coven",
        "tags": ["control", "puppet", "cooldown-manip", "misc"],
        "target": { "aggression": 1, "strategy": 6, "social": 1, "visibility": -1, "control": 9, "risk": 3, "loyalty": 6, "power": 4 },
        "weight": 1.2
      },
      {
        "id": "empress",
        "name": "Empress",
        "faction": "coven",
        "tags": ["power", "spells", "empower", "support"],
        "target": { "aggression": 2, "strategy": 6, "social": 2, "visibility": 1, "control": 7, "risk": 2, "loyalty": 7, "power": 5 },
        "weight": 1.2
      },
      {
        "id": "augur",
        "name": "Augur",
        "faction": "coven",
        "tags": ["guessing", "meeting", "misc"],
        "target": { "aggression": 0, "strategy": 7, "social": 4, "visibility": 1, "control": 4, "risk": 3, "loyalty": 6, "power": 3 },
        "weight": 1.1
      },
      {
        "id": "potion_master",
        "name": "Potion Master",
        "faction": "coven",
        "tags": ["utility", "reveal", "shield", "support"],
        "target": { "aggression": 1, "strategy": 6, "social": 2, "visibility": 0, "control": 6, "risk": 1, "loyalty": 7, "power": 3 },
        "weight": 1.0
      },
      {
        "id": "reaper",
        "name": "Reaper",
        "faction": "coven",
        "tags": ["curse", "souls", "transform", "misc"],
        "target": { "aggression": 2, "strategy": 6, "social": -1, "visibility": -1, "control": 6, "risk": 2, "loyalty": 7, "power": 5 },
        "weight": 1.1
      },
      {
        "id": "death",
        "name": "Death",
        "faction": "coven",
        "tags": ["immortal", "killer", "transform"],
        "target": { "aggression": 6, "strategy": 4, "social": -2, "visibility": 0, "control": 4, "risk": 1, "loyalty": 7, "power": 7 },
        "weight": 1.1
      },
      {
        "id": "illusionist",
        "name": "Illusionist",
        "faction": "coven",
        "tags": ["deception", "morph", "stealth"],
        "target": { "aggression": 1, "strategy": 7, "social": 2, "visibility": -4, "control": 5, "risk": 2, "loyalty": 6, "power": 4 },
        "weight": 1.0
      },
      {
        "id": "enchanter",
        "name": "Enchanter",
        "faction": "coven",
        "tags": ["deception", "frame", "investigators"],
        "target": { "aggression": 1, "strategy": 7, "social": 1, "visibility": -3, "control": 6, "risk": 2, "loyalty": 6, "power": 4 },
        "weight": 1.0
      },
      {
        "id": "goddess",
        "name": "Goddess",
        "faction": "coven",
        "tags": ["counter", "stone-gaze", "unreportable", "killer"],
        "target": { "aggression": 5, "strategy": 4, "social": -2, "visibility": -1, "control": 6, "risk": 2, "loyalty": 6, "power": 6 },
        "weight": 1.1
      },
      {
        "id": "poache",
        "name": "Poache",
        "faction": "coven",
        "tags": ["control", "vote-deny", "poison", "misc"],
        "target": { "aggression": 1, "strategy": 6, "social": 2, "visibility": -1, "control": 8, "risk": 2, "loyalty": 6, "power": 4 },
        "weight": 1.0
      },
      {
        "id": "spellcaster",
        "name": "Spellcaster",
        "faction": "coven",
        "tags": ["win-trigger", "hex", "hidden", "misc"],
        "target": { "aggression": 1, "strategy": 7, "social": 1, "visibility": -5, "control": 7, "risk": 2, "loyalty": 7, "power": 7 },
        "weight": 1.3
      },
      {
        "id": "timelord",
        "name": "Timelord",
        "faction": "coven",
        "tags": ["cooldown", "tempo", "meeting-time", "control"],
        "target": { "aggression": 1, "strategy": 7, "social": 1, "visibility": -1, "control": 9, "risk": 2, "loyalty": 7, "power": 5 },
        "weight": 1.1
      },
      {
        "id": "dreamweaver",
        "name": "Dreamweaver",
        "faction": "coven",
        "tags": ["insane", "forced-ability", "debuff", "control"],
        "target": { "aggression": 0, "strategy": 6, "social": 1, "visibility": -2, "control": 9, "risk": 4, "loyalty": 6, "power": 5 },
        "weight": 1.1
      },
      {
        "id": "wyrd",
        "name": "Wyrd",
        "faction": "coven",
        "tags": ["countdown", "fate", "trap", "control"],
        "target": { "aggression": 2, "strategy": 7, "social": -1, "visibility": -2, "control": 8, "risk": 3, "loyalty": 6, "power": 5 },
        "weight": 1.0
      },
      {
        "id": "coven_leader",
        "name": "Coven Leader",
        "faction": "coven",
        "tags": ["leader", "killer", "necronomicon-first"],
        "target": { "aggression": 5, "strategy": 5, "social": 1, "visibility": 0, "control": 6, "risk": 1, "loyalty": 8, "power": 6 },
        "weight": 1.2
      },
      {
        "id": "coven_member",
        "name": "Coven Member",
        "faction": "coven",
        "tags": ["promote", "fallback", "team"],
        "target": { "aggression": 0, "strategy": 4, "social": 0, "visibility": -1, "control": 2, "risk": 0, "loyalty": 9, "power": 2 },
        "weight": 0.9
      }
    ];

    function mergeRolesPreferExtra(base, extra){
      const m = new Map();
      base.forEach(r => m.set(r.id, r));
      extra.forEach(r => {
        const normalized = { archetype: [], ...r };
        m.set(normalized.id, normalized);
      });
      return Array.from(m.values());
    }

    const rolePool = mergeRolesPreferExtra(baseRolePool, extraRolePool);

    const addonPool = [
      { id:"sleuth", name:"Sleuth", tags:["info"], meaning:"You naturally notice small clues and timing tells." },
      { id:"lucky", name:"Lucky", tags:["risk"], meaning:"You take chances, and it often pays off." },
      { id:"shy", name:"Shy", tags:["stealth"], meaning:"You avoid attention and prefer subtle positioning." },
      { id:"energetic", name:"Energetic", tags:["tempo"], meaning:"You keep the round moving and hate stalling." },
      { id:"watcher", name:"Watcher", tags:["info"], meaning:"You like tracking who goes where and when." },
      { id:"torch", name:"Torch", tags:["visibility"], meaning:"You prefer clear sightlines and obvious information." },
      { id:"tired", name:"Tired", tags:["safe"], meaning:"You prefer low-risk lines and consistent choices." },
      { id:"mischievous", name:"Mischievous", tags:["chaos"], meaning:"You like stirring the pot and forcing reactions." },
      { id:"loyal", name:"Loyal", tags:["team"], meaning:"You stick with your side and play to enable others." },
      { id:"nimble", name:"Nimble", tags:["movement"], meaning:"You value mobility and quick repositioning." },
    ];

    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }
    function distance(a,b){ let d=0; for(const k of TRAIT_KEYS) d += Math.abs((a[k]??0)-(b[k]??0)); return d; }
    function applyEffects(traits, effects){ for(const [k,v] of Object.entries(effects)) traits[k]=(traits[k]??0)+v; }
    function topTraits(traits, count=3){
      const entries = Object.entries(traits).map(([k,v])=>[k,v]);
      entries.sort((a,b)=>Math.abs(b[1]) - Math.abs(a[1]));
      return entries.slice(0,count);
    }
    function normalizeTraits(traits){
      const out={}; for(const k of TRAIT_KEYS) out[k]=clamp(traits[k]??0,-12,12); return out;
    }

    function pickArchetype(player){
      let best=null, bestD=Infinity;
      for(const a of archetypes){
        const d = distance(player, a.target);
        if(d < bestD){ bestD=d; best=a; }
      }
      return { archetype: best, dist: bestD };
    }

    function factionFromTraits(player, archetype){
      const base = { crewmate:1, impostor:1, neutral:1, coven:1 };
      for(const f of Object.keys(base)) base[f] *= (archetype.factionBias[f] ?? 1);

      base.crewmate *= (1 + Math.max(0, player.loyalty) * 0.06);
      base.coven    *= (1 + Math.max(0, player.control) * 0.04);

      base.neutral  *= (1 + Math.max(0, -player.loyalty) * 0.06);
      base.impostor *= (1 + Math.max(0, player.social) * 0.04);

      base.impostor *= (1 + Math.max(0, player.aggression) * 0.03);
      base.neutral  *= (1 + Math.max(0, player.power) * 0.03);

      const entries = Object.entries(base);
      const total = entries.reduce((s, [,w]) => s+w, 0);
      let r = Math.random()*total;
      for(const [f,w] of entries){ r -= w; if(r<=0) return f; }
      return "neutral";
    }

    function pickRole(player, archetypeId, faction){
      const factionRoles = rolePool.filter(r => r.faction === faction);

      const preferred = factionRoles.filter(r => Array.isArray(r.archetype) && r.archetype.length && r.archetype.includes(archetypeId));
      const pool = preferred.length ? preferred : factionRoles;

      let best=null, bestScore=Infinity;
      for(const r of pool){
        const roleTarget = r.target || (archetypes.find(a => a.id === archetypeId)?.target) || {};
        const w = (r.weight ?? 1);
        const d = distance(player, roleTarget) / w;
        if(d < bestScore){ bestScore=d; best=r; }
      }
      return best;
    }

    function pickAddon(player){
      const tops = topTraits(player, 2).map(([k]) => k);
      const tagMap = {
        aggression:["tempo"], strategy:["info"], social:["chaos","info"], visibility:["visibility","stealth"],
        control:["info"], risk:["risk","chaos"], loyalty:["team"], power:["tempo","movement"]
      };
      const desiredTags = new Set();
      tops.forEach(t => (tagMap[t] || []).forEach(tag => desiredTags.add(tag)));

      const matches = addonPool.filter(a => a.tags.some(tag => desiredTags.has(tag)));
      const pool = matches.length ? matches : addonPool;

      if(Math.random() < 0.25) return null;
      return pool[Math.floor(Math.random()*pool.length)];
    }

    function explainFaction(faction){
      switch (faction){
        case "crewmate": return "Crewmates win through coordination, information, and stability. This result suggests you prefer structured play and consistent decision-making.";
        case "impostor": return "Impostors win through deception, timing, and pressure. This result suggests you like influencing outcomes and creating uncertainty.";
        case "neutral":  return "Neutrals win with special goals or flexible paths. This result suggests you value independence, clever positioning, and adapting on the fly.";
        case "coven":    return "Coven win through layered control and teamwork. This result suggests you like orchestrating tempo and shaping the game behind the scenes.";
        default: return "Your faction describes your core play identity.";
      }
    }

    function fallbackRoleMeaning(role){
      const tags = Array.isArray(role.tags) && role.tags.length ? role.tags.join(", ") : "no tags";
      const target = role.target ? "Custom target profile" : "Archetype target profile";
      return `This role was picked by matching your trait profile to its target. (${target}; tags: ${tags})`;
    }

    const STORAGE_KEY = "eh_role_quiz_v1";

    let state = { idx:0, traits: defaultTraits(), picks: Array(questions.length).fill(null), finished:false };

    const hero = document.getElementById("hero");
    const quizPanel = document.getElementById("quizPanel");
    const resultPanel = document.getElementById("resultPanel");

    const qTitle = document.getElementById("qTitle");
    const qSub = document.getElementById("qSub");
    const answersEl = document.getElementById("answers");
    const qIndexText = document.getElementById("qIndexText");
    const progressBar = document.getElementById("progressBar");
    const autosaveText = document.getElementById("autosaveText");

    const resultHeadline = document.getElementById("resultHeadline");
    const tagFaction = document.getElementById("tagFaction");
    const tagRole = document.getElementById("tagRole");
    const tagAddon = document.getElementById("tagAddon");
    const resultMeaning = document.getElementById("resultMeaning");
    const whyPills = document.getElementById("whyPills");
    const debugOut = document.getElementById("debugOut");

    const btnStart = document.getElementById("btn-start");
    const btnLoad = document.getElementById("btn-load");
    const btnBack = document.getElementById("btn-back");
    const btnReset = document.getElementById("btn-reset");
    const btnRestart = document.getElementById("btn-restart");
    const btnReroll = document.getElementById("btn-reroll");

    const nav = document.getElementById("nav");
    const navBtn = document.getElementById("navBtn");

    const menuSave = document.getElementById("menu-save");
    const menuLoad = document.getElementById("menu-load");
    const menuReset = document.getElementById("menu-reset");
    const menuSkip = document.getElementById("menu-skip");

    function saveState(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      autosaveText.textContent = "Autosave: Saved";
      setTimeout(() => autosaveText.textContent = "Autosave: ON", 700);
    }
    function loadState(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return false;
      try{
        const parsed = JSON.parse(raw);
        if(!parsed || typeof parsed !== "object") return false;
        if(!Array.isArray(parsed.picks) || parsed.picks.length !== questions.length) return false;
        state = parsed;
        state.traits = { ...defaultTraits(), ...(state.traits || {}) };
        return true;
      }catch{ return false; }
    }
    function resetState(){
      state = { idx:0, traits: defaultTraits(), picks: Array(questions.length).fill(null), finished:false };
      localStorage.removeItem(STORAGE_KEY);
    }

    function showQuiz(){
      hero.classList.add("hidden");
      quizPanel.classList.remove("hidden");
      resultPanel.classList.add("hidden");
      renderQuestion();
    }
    function showResults(){
      hero.classList.add("hidden");
      quizPanel.classList.add("hidden");
      resultPanel.classList.remove("hidden");
      renderResults();
    }
    function startFresh(){
      resetState();
      saveState();
      showQuiz();
    }

    function recomputeTraitsFromPicks(){
      const t = defaultTraits();
      for(let i=0;i<questions.length;i++){
        const pick = state.picks[i];
        if(pick === null) continue;
        applyEffects(t, questions[i].answers[pick].effects);
      }
      state.traits = t;
    }

    function renderQuestion(){
      const q = questions[state.idx];
      qTitle.textContent = q.text;
      qSub.textContent = q.sub || "Pick what fits you best.";
      qIndexText.textContent = `Q ${state.idx+1} / ${questions.length}`;

      const pct = Math.round((state.idx / questions.length) * 100);
      progressBar.style.width = `${pct}%`;

      answersEl.innerHTML = "";
      const letters = ["A","B","C","D"];
      q.answers.forEach((ans, i) => {
        const btn = document.createElement("button");
        btn.className = "answer";
        btn.type = "button";
        btn.innerHTML = `<span class="letter">${letters[i]}</span><span class="text">${ans.text}</span>`;
        btn.addEventListener("click", () => chooseAnswer(i));
        answersEl.appendChild(btn);
      });

      btnBack.style.opacity = state.idx === 0 ? "0.45" : "1";
      btnBack.style.pointerEvents = state.idx === 0 ? "none" : "auto";
    }

    function chooseAnswer(answerIndex){
      state.picks[state.idx] = answerIndex;
      recomputeTraitsFromPicks();

      state.idx += 1;
      if(state.idx >= questions.length){
        state.finished = true;
        saveState();
        showResults();
        return;
      }
      saveState();
      renderQuestion();
    }

    function goBack(){
      if(state.idx <= 0) return;
      state.idx -= 1;
      saveState();
      renderQuestion();
    }

    function renderResults(addonOverride=null){
      const player = normalizeTraits(state.traits);
      const { archetype } = pickArchetype(player);
      const faction = factionFromTraits(player, archetype);
      const role = pickRole(player, archetype.id, faction);

      const addon = addonOverride === "none"
        ? null
        : (addonOverride || pickAddon(player));

      resultHeadline.textContent = `You are: ${role.name}`;
      tagFaction.innerHTML = `<i class="fa-solid fa-flag"></i> Faction: ${faction.toUpperCase()}`;
      tagRole.innerHTML = `<i class="fa-solid fa-user-secret"></i> Role: ${role.name}`;
      tagAddon.innerHTML = addon
        ? `<i class="fa-solid fa-puzzle-piece"></i> Add-on: ${addon.name}`
        : `<i class="fa-solid fa-puzzle-piece"></i> Add-on: (none)`;

      const factionExplain = explainFaction(faction);
      const roleExplain = role.meaning || fallbackRoleMeaning(role);
      const archExplain = archetype.meaning;
      const addonExplain = addon ? addon.meaning : "No add-on was assigned — your identity stands strongly on its own.";

      resultMeaning.innerHTML = `
        <strong>${archetype.name}</strong> vibe: ${archExplain}<br><br>
        <strong>Faction meaning:</strong> ${factionExplain}<br><br>
        <strong>Role meaning:</strong> ${roleExplain}<br><br>
        <strong>${addon ? "Add-on meaning" : "Add-on"}:</strong> ${addonExplain}
      `;

      whyPills.innerHTML = "";
      const top = topTraits(player, 4);
      const pretty = {
        aggression:"Aggression", strategy:"Strategy", social:"Social", visibility:"Visibility",
        control:"Control", risk:"Risk", loyalty:"Loyalty", power:"Power Scale"
      };
      top.forEach(([k,v]) => {
        const pill = document.createElement("div");
        pill.className = "pill";
        const sign = v >= 0 ? "+" : "";
        pill.innerHTML = `<i class="fa-solid fa-chart-simple"></i> <strong>${pretty[k]}:</strong> ${sign}${v}`;
        whyPills.appendChild(pill);
      });

      debugOut.textContent = JSON.stringify({
        traits: player,
        archetype: { id: archetype.id, name: archetype.name },
        faction,
        role: {
          id: role.id,
          name: role.name,
          tags: role.tags || [],
          weight: role.weight ?? 1,
          target: role.target || null
        },
        addon: addon ? { id: addon.id, name: addon.name } : null,
        rolePoolSize: rolePool.length
      }, null, 2);
    }

    btnStart.addEventListener("click", startFresh);
    btnLoad.addEventListener("click", () => {
      if(loadState()){
        if(state.finished) showResults();
        else showQuiz();
      } else startFresh();
    });
    btnBack.addEventListener("click", goBack);
    btnReset.addEventListener("click", () => { if(confirm("Reset quiz progress?")) startFresh(); });
    btnRestart.addEventListener("click", startFresh);
    btnReroll.addEventListener("click", () => {
      const player = normalizeTraits(state.traits);
      const addon = pickAddon(player);
      renderResults(addon || "none");
    });

    navBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      nav.classList.toggle("open");
    });
    document.addEventListener("click", (e) => {
      if(!nav.contains(e.target)) nav.classList.remove("open");
    });

    menuSave.addEventListener("click", () => saveState());
    menuLoad.addEventListener("click", () => {
      nav.classList.remove("open");
      if(loadState()){
        if(state.finished) showResults();
        else showQuiz();
      } else alert("No saved progress found.");
    });
    menuReset.addEventListener("click", () => {
      nav.classList.remove("open");
      if(confirm("Reset quiz progress?")) startFresh();
    });
    menuSkip.addEventListener("click", () => {
      nav.classList.remove("open");
      state.picks = state.picks.map(() => Math.floor(Math.random()*4));
      recomputeTraitsFromPicks();
      state.finished = true;
      state.idx = questions.length;
      saveState();
      showResults();
    });

    (function init(){
    })();
  </script>
</body>
</html>
